var THREEx=THREEx||{};THREEx.createAtmosphereMaterial=function(){var a=new THREE.ShaderMaterial({uniforms:{coeficient:{type:"f",value:1},power:{type:"f",value:0},glowColor:{type:"c",value:new THREE.Color("pink")}},vertexShader:"varying vec3\tvVertexWorldPosition;\nvarying vec3\tvVertexNormal;\nvarying vec4\tvFragColor;\nvoid main(){\n\tvVertexNormal\t= normalize(normalMatrix * normal);\n\tvVertexWorldPosition\t= (modelMatrix * vec4(position, 1.0)).xyz;\n\t// set gl_Position\n\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"uniform vec3\tglowColor;\nuniform float\tcoeficient;\nuniform float\tpower;\nvarying vec3\tvVertexNormal;\nvarying vec3\tvVertexWorldPosition;\nvarying vec4\tvFragColor;\nvoid main(){\n\tvec3 worldCameraToVertex= vVertexWorldPosition - cameraPosition;\n\tvec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;\n\tviewCameraToVertex\t= normalize(viewCameraToVertex);\n\tfloat intensity\t\t= pow(coeficient + dot(vVertexNormal, viewCameraToVertex), power);\n\tgl_FragColor\t\t= vec4(glowColor, intensity);\n}",transparent:!0,depthWrite:!1});return a};var THREEx=THREEx||{};THREEx.GeometricGlowMesh=function(a){var b=new THREE.Object3D,c=a.geometry.clone(),d=THREEx.createAtmosphereMaterial();d.uniforms.glowColor.value=new THREE.Color(9276813),d.uniforms.coeficient.value=1.1,d.uniforms.power.value=1.4;var e=new THREE.Mesh(c,d);b.add(e);var c=a.geometry.clone(),d=THREEx.createAtmosphereMaterial();d.uniforms.glowColor.value=new THREE.Color(9276813),d.uniforms.coeficient.value=.1,d.uniforms.power.value=5,d.side=THREE.BackSide;var f=new THREE.Mesh(c,d);b.add(f),this.object3d=b,this.insideMesh=e,this.outsideMesh=f},function(a){function b(a,b,c){this.x=a,this.y=b,this.z=c}function c(a){return a*a*a*(a*(6*a-15)+10)}function d(c,a,b){return(1-b)*c+b*a}var e=a.noise={};b.prototype.dot2=function(a,b){return this.x*a+this.y*b},b.prototype.dot3=function(a,b,c){return this.x*a+this.y*b+this.z*c};var f=[new b(1,1,0),new b(-1,1,0),new b(1,-1,0),new b(-1,-1,0),new b(1,0,1),new b(-1,0,1),new b(1,0,-1),new b(-1,0,-1),new b(0,1,1),new b(0,-1,1),new b(0,1,-1),new b(0,-1,-1)],g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=Array(512),l=Array(512);e.seed=function(a){0<a&&1>a&&(a*=65536),a=Math.floor(a),256>a&&(a|=a<<8);for(var b=0;256>b;b++){var c;c=1&b?g[b]^255&a:g[b]^255&a>>8,h[b]=h[b+256]=c,l[b]=l[b+256]=f[c%12]}},e.seed(0);var m=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,n=1/6;e.simplex2=function(a,b){var c,d,e,f,g,n=(a+b)*m,o=Math.floor(a+n),p=Math.floor(b+n),q=(o+p)*k,r=a-o+q,s=b-p+q;r>s?(f=1,g=0):(f=0,g=1);var t=r-f+k,u=s-g+k,v=r-1+2*k,w=s-1+2*k;o&=255,p&=255;var x=l[o+h[p]],y=l[o+f+h[p+g]],z=l[o+1+h[p+1]],A=.5-r*r-s*s;0>A?c=0:(A*=A,c=A*A*x.dot2(r,s));var B=.5-t*t-u*u;0>B?d=0:(B*=B,d=B*B*y.dot2(t,u));var C=.5-v*v-w*w;return 0>C?e=0:(C*=C,e=C*C*z.dot2(v,w)),70*(c+d+e)},e.simplex3=function(a,b,c){var d,e,f,g,m,o,p,q,r,u,v=(a+b+c)*(1/3),s=Math.floor(a+v),w=Math.floor(b+v),x=Math.floor(c+v),y=(s+w+x)*n,t=a-s+y,z=b-w+y,A=c-x+y;t>=z?z>=A?(m=1,o=0,p=0,q=1,r=1,u=0):t>=A?(m=1,o=0,p=0,q=1,r=0,u=1):(m=0,o=0,p=1,q=1,r=0,u=1):z<A?(m=0,o=0,p=1,q=0,r=1,u=1):t<A?(m=0,o=1,p=0,q=0,r=1,u=1):(m=0,o=1,p=0,q=1,r=1,u=0);var B=t-m+n,C=z-o+n,D=A-p+n,E=t-q+2*n,F=z-r+2*n,G=A-u+2*n,H=t-1+3*n,I=z-1+3*n,J=A-1+3*n;s&=255,w&=255,x&=255;var K=l[s+h[w+h[x]]],L=l[s+m+h[w+o+h[x+p]]],M=l[s+q+h[w+r+h[x+u]]],N=l[s+1+h[w+1+h[x+1]]],O=.6-t*t-z*z-A*A;0>O?d=0:(O*=O,d=O*O*K.dot3(t,z,A));var P=.6-B*B-C*C-D*D;0>P?e=0:(P*=P,e=P*P*L.dot3(B,C,D));var Q=.6-E*E-F*F-G*G;0>Q?f=0:(Q*=Q,f=Q*Q*M.dot3(E,F,G));var R=.6-H*H-I*I-J*J;return 0>R?g=0:(R*=R,g=R*R*N.dot3(H,I,J)),32*(d+e+f+g)},e.perlin2=function(a,b){var e=Math.floor(a),f=Math.floor(b);a-=e,b-=f,e&=255,f&=255;var g=l[e+h[f]].dot2(a,b),i=l[e+h[f+1]].dot2(a,b-1),j=l[e+1+h[f]].dot2(a-1,b),k=l[e+1+h[f+1]].dot2(a-1,b-1),m=c(a);return d(d(g,j,m),d(i,k,m),c(b))},e.perlin3=function(a,b,e){var f=Math.floor(a),g=Math.floor(b),i=Math.floor(e);a-=f,b-=g,e-=i,f&=255,g&=255,i&=255;var j=l[f+h[g+h[i]]].dot3(a,b,e),k=l[f+h[g+h[i+1]]].dot3(a,b,e-1),m=l[f+h[g+1+h[i]]].dot3(a,b-1,e),n=l[f+h[g+1+h[i+1]]].dot3(a,b-1,e-1),o=l[f+1+h[g+h[i]]].dot3(a-1,b,e),p=l[f+1+h[g+h[i+1]]].dot3(a-1,b,e-1),q=l[f+1+h[g+1+h[i]]].dot3(a-1,b-1,e),r=l[f+1+h[g+1+h[i+1]]].dot3(a-1,b-1,e-1),s=c(a),t=c(b),u=c(e);return d(d(d(j,o,s),d(k,p,s),u),d(d(m,q,s),d(n,r,s),u),t)}}(this);THREE.TreeSpawner=function(a){a=a||{},this.theta=a.theta||.5*Math.PI,this.attenuation=a.attenuation||.75,this.rootRange=a.rootRange||new THREE.Vector2(.75,1)},THREE.TreeSpawner.prototype={spawn:function(a,b){var c=this.theta,d=this.attenuation,e=.5*c,f=Math.random()*c-e,g=Math.random()*c-e,h=a.length*d,i=new THREE.Matrix4,j=new THREE.Euler(f,0,g);i.makeRotationFromEuler(j),i.multiply(a.rotation);var k;b=b||!1,k=b?a.segments.length-1:Math.floor((Math.random()*(this.rootRange.y-this.rootRange.x)+this.rootRange.x)*a.segments.length);var l=a.segments[k];return new THREE.TreeBranch({from:l,rotation:i,length:h,uvOffset:l.uvOffset,uvLength:a.uvLength,generation:a.generation+1,generations:a.generations,radius:a.radius,radiusSegments:a.radiusSegments,heightSegments:a.heightSegments})}},THREE.TreeBranch=function(a){var b=a.from;this.rotation=a.rotation,this.length=a.length,this.generation=a.generation||0,this.generations=a.generations,this.uvLength=a.uvLength||10,this.uvOffset=a.uvOffset||0,this.radius=a.radius||.1,this.radiusSegments=a.radiusSegments,this.heightSegments=a.heightSegments,b instanceof THREE.TreeSegment?(this.from=b,this.position=b.position.clone().add(new THREE.Vector3(0,1,0).applyMatrix4(b.rotation).setLength(.05))):b instanceof THREE.Vector3?(this.from=null,this.position=b):console.warning("from argument is missing !");var c=new THREE.Vector3(0,1,0).applyMatrix4(this.rotation);this.to=this.position.clone().add(c.setLength(this.length)),this.segments=this.buildTreeSegments(this.radius,this.radiusSegments,c,this.heightSegments),this.children=[]},THREE.TreeBranch.prototype={buildTreeSegments:function(a,b,c,e){var f=.25*Math.PI,g=.5*f,h=Math.random()*f-g,j=Math.random()*f-g,k=new THREE.Matrix4,l=new THREE.Euler(h,0,j);k.makeRotationFromEuler(l),c.applyMatrix4(k);var m=this.position.clone().add(c.setLength(.5*this.length)),n=new THREE.CatmullRomCurve3([this.position,m,this.to]),o=0==this.generation?1:1-this.generation/(this.generations+1),p=1-(this.generation+1)/(this.generations+1),q=a*o,r=a*p,s=this.rotation,t=[],u=this.uvLength,v=this.uvOffset,w=n.getPoints(e);null!==this.from&&(v+=this.from.position.distanceTo(w[0])/u),t.push(new THREE.TreeSegment(w[0],s,v,q,b));for(var x=1;x<e;x++){var y=w[x],z=w[x+1],A=x/(e-1),a=q+(r-q)*A,B=z.distanceTo(y);v+=B/u;var d=new THREE.TreeSegment(y,s,v,a,b);t.push(d)}return t},branch:function(a,b){for(var c=0;c<b;c++)this.spawn(a,0==c);this.children.forEach(function(c){c.branch(a,b-1)})},grow:function(a){0>=this.children.length?this.branch(a,1):this.children.forEach(function(b){b.grow(a)})},spawn:function(a,b){var c=a.spawn(this,b);this.children.push(c)},branchlets:function(){return 0==this.children.length?this:Array.prototype.concat.apply([],this.children.map(function(a){return a.branchlets()}))},calculateLength:function(){for(var a=this.segments,b=0,c=0,d=a.length-1;c<d;c++){var e=a[c].position,f=a[c+1].position;b+=e.distanceTo(f)}return b}},THREE.TreeSegment=function(a,b,c,d,e){this.position=a,this.rotation=b,this.uvOffset=c,this.radius=d,this.vertices=[],this.uvs=[],this.build(d,e)},THREE.TreeSegment.prototype={build:function(a,b){for(var c=2*Math.PI,d=0;d<=b;d++){var e=d/b,f=new THREE.Vector3(a*Math.sin(e*c),0,a*Math.cos(e*c)).applyMatrix4(this.rotation).add(this.position);this.vertices.push(f),this.uvs.push(new THREE.Vector2(e,this.uvOffset))}}},THREE.Tree=function(a,b){a=a||{};var c=a.from||new THREE.Vector3,d=new THREE.Matrix4;if(a.rotation)if(a.rotation instanceof THREE.Euler){var e=a.rotation;d.makeRotationFromEuler(e)}else a.rotation instanceof THREE.Matrix4&&(d=a.rotation);var f=a.length||3,g=a.uvLength||10,h=a.generations===void 0?5:a.generations,i=a.radius||.1;this.radiusSegments=a.radiusSegments||8,this.heightSegments=a.heightSegments||8,this.generations=h,this.root=new THREE.TreeBranch({from:c,rotation:d,length:f,uvLength:g,generation:0,generations:this.generations,radius:i,radiusSegments:this.radiusSegments,heightSegments:this.heightSegments}),this.spawner=b||new THREE.TreeSpawner,this.root.branch(this.spawner,this.generations)},THREE.Tree.prototype={grow:function(a,b){b=b||this.spawner,this.generation++,this.root.grow(b,a)},branchlets:function(){return this.root.branchlets()}};THREE.TreeGeometry={build:function(a){var b=new THREE.Geometry;return this.buildBranches(a.root,b),b.computeFaceNormals(),b.computeVertexNormals(),b},buildBranches:function(a,b){for(var c=a.radiusSegments,d=a.segments.length-1,e=2*Math.PI,f=[],g=[],h=[],i=[],j=[],k=0,l=b.vertices.length,m=0;m<=d;m++){var n=[],o=a.segments[m];f=f.concat(o.vertices),j.push(o.uvs);for(var p=0;p<=c;p++)n.push(k++);i.push(n)}for(var p=0;p<c;p++)for(var m=0;m<d;m++){var q=m,r=m+1,s=p,t=p+1,u=i[q][s]+l,v=i[r][s]+l,w=i[r][t]+l,z=i[q][t]+l,A=j[q][s],B=j[r][s],C=j[r][t],D=j[q][t];g.push(new THREE.Face3(u,z,v)),h.push([A,D,B]),g.push(new THREE.Face3(v,z,w)),h.push([B,D,C])}if(null===a.from){var E=a.segments[0];f.push(E.position),i.push(k++);for(var m=0,p=0;p<c;p++){var u=i[m][p]+l,v=i[m][p+1]+l,w=k-1+l,A=j[m][p],B=j[m][p+1],C=new THREE.Vector2(B.x,a.uvOffset);g.push(new THREE.Face3(u,w,v)),h.push([A,C,B])}}else{var F=a.from,m=0;f=f.concat(F.vertices);for(var G=[],p=0;p<=c;p++)G.push(k++ +l);for(var p=0;p<c;p++){var H=i[m][p]+l,u=i[m][p+1]+l,v=G[p],w=G[p+1],I=j[m][p],A=j[m][p+1],B=F.uvs[p],C=F.uvs[p+1];g.push(new THREE.Face3(H,w,u)),h.push([I,C,A]),g.push(new THREE.Face3(H,v,w)),h.push([I,B,C])}}b.vertices=b.vertices.concat(f),b.faces=b.faces.concat(g),b.faceVertexUvs[0]=b.faceVertexUvs[0].concat(h);var J=this;a.children.forEach(function(a){J.buildBranches(a,b)})},buildLineStrips:function(a){var b=[],c=function(a){for(var d=a.segments,e=0,f=d.length;e<f-1;e++){var g=d[e],h=d[e+1];b.push(g.position,h.position)}a.children.forEach(function(a){c(a)})};c(a.root);var d=new THREE.Geometry;return d.vertices=b,d},calculateLength:function(a){return this.calculateSegmentLength(a.root)},calculateSegmentLength:function(a){var b=0,c=this;return a.children.forEach(function(a){var d=c.calculateSegmentLength(a);d>b&&(b=d)}),b+a.calculateLength()}};function activate(a,b){a=a||document,a.addEventListener("dragover",function(a){a.preventDefault(),a.dataTransfer.dropEffect="copy"}),a.addEventListener("drop",function(a){a.preventDefault();var c=a.dataTransfer.files;0<c.length&&handleFile(c[0],b)})}function loadFile(a,b){var c=a.name,d=new FileReader;d.addEventListener("progress",function(a){var b="("+Math.floor(a.total/1e3).toFixed(2)+" KB)",d=Math.floor(100*(a.loaded/a.total))+"%";console.log("Loading",c,b,d)}),d.addEventListener("load",a=>{var d=a.target.result,e=new THREE.OBJLoader().parse(d);e.name=c,b(e)}),d.readAsText(a)}function handleFile(a,b){var c=a.name,d=c.split(".").pop().toLowerCase();loadFile(a,b)}